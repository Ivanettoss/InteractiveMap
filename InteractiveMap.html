<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map</title>
    <link rel="stylesheet" href="stylesmap.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
        <!-- user buoy creation js-->
        <script src="userInteraction.js" ></script>
    
		<h1>S.A.I.L. SMART AUTONOMOUS INTERACTIVE LOCALIZATION</h1>
        
    <div id="core">
    <!-- Map Object -->
    <div id="map"></div>
    <button id="newBuoy", onClick="insertBuoyData()">Inserisci nuova boa</button>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  

    <script>

        // Inizialize the  map ([Long,Lat],zoom)
        var map = L.map('map').setView([42.030761, 11.909473],13);

        // Add a tile layer 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Define 3 objects 
        var circle1 = L.circle([42.021378, 11.931883 ], {
            color: 'red',
            fillColor: '#red',
            radius: 50    // radious of the circle in meters 
        }).addTo(map);

        var circle2 = L.circle([42.028743, 11.866492 ], {
            color: 'blue',
            fillColor: '#blue',
            radius: 50 // radius of the circle in meters 
        }).addTo(map);

        var circle3 = L.circle([ 42.017101, 11.890186], {
            color: 'green',
            fillColor: '#green',
            radius: 50 // radius of the circle in meters 
        }).addTo(map);



        // Define  pop up event on object

        circle1.on("mouseover", function(e){
            var latlng = e.latlng;  // get the lat and long of the device 
            var popup1 = L.popup()
            .setLatLng(latlng)   // set the Lat and Long of the popup
            .setContent('Buoy 1: ' + latlng)  // Popup text
            .openOn(map);        
    });

    circle1.on("mouseout", function() {
        map.closePopup(); 
    });

        circle2.on("mouseover", function(e){
                var latlng = e.latlng;  
                var popup2 = L.popup()
                .setLatLng(latlng)   
                .setContent('Buoy 2: ' + latlng)  
                .openOn(map);       
        });

        circle2.on("mouseout", function() {
        map.closePopup(); 
    });


    circle3.on("mouseover", function(e){
                var latlng = e.latlng;  
                var popup3 = L.popup()
                .setLatLng(latlng)   
                .setContent('Buoy 3: ' + latlng)  
                .openOn(map);       
        });

        circle3.on("mouseout", function() {
        map.closePopup(); 
    });


    
    var buoyIcon = L.icon({
        iconUrl: 'icon/dynamicBuoy.png',
        iconSize: [25, 25],
        iconAnchor: [0, 0],
        popupAnchor: [0, 0],
});
     var markerBuoy = L.marker([42.026439, 11.912144], {icon: buoyIcon}).addTo(map);

     // add a popup on the marker
     markerBuoy.on("mouseover", function(e){
                var latlng = e.latlng;  
                var popup4 = L.popup()
                .setLatLng(latlng)   
                .setContent('StaticBuoy: ' + latlng)  
                .openOn(map);       
        });

        markerBuoy.on("mouseout", function() {
        map.closePopup(); 
        });

// define objects with personalized icon 
var myIcon = L.icon({
   iconUrl: 'icon/sailingBoat.png',
   iconSize: [30, 25],
   iconAnchor: [0, 0],
   popupAnchor: [0, 0],
});

var marker1 = L.marker([42.035648, 11.882662], {icon: myIcon}).addTo(map);
// add a popup on the marker
marker1.on("mouseover", function(e){
           var latlng = e.latlng;  
           var popup4 = L.popup()
           .setLatLng(latlng)   
           .setContent('SailBoat: ' + latlng)  
           .openOn(map);       
   });

   marker1.on("mouseout", function() {
   map.closePopup(); 
});

    boatSteps = [
    [
        [42.035648, 11.882662], // start
        [42.045648, 11.892662],
        [42.055648, 11.902662],
        [42.065648, 11.912662],
        [42.075648, 11.922662], 
        [42.085648, 11.932662],
        [42.095648, 11.942662], 
        [42.105648, 11.952662],
        [42.115648, 11.962662], 
        [42.125648, 11.972662],
        [42.135648, 11.982662], 
        [42.145648, 11.992662], 
        [42.155648, 12.002662], 
        [42.165648, 12.012662], 
        [42.175648, 12.022662], 
        [42.185648, 12.032662], 
        [42.195648, 12.042662], 
        [42.205648, 12.052662], 
        [42.215648, 12.062662], 
        [42.225648, 12.072662], 
        [42.235648, 12.082662], 
        [42.017101, 11.890186]  // back to start
    ]
]



// Animazione del marker
function moveMarker(marker,newLat,newLong) {
       setTimeout(function() {
        marker1.setLatLng([newLat, newLong]);
    }, 2000); 
}

function animation(marker,position){
    for(let i=0;i<position.length;i++){

        for(let j=0;j<position[i].length;j++){

           let currentCoordinate=position[i][j]
           console.log(currentCoordinate)
           let currentLat=currentCoordinate[0]
           let currentLong=currentCoordinate[1]

           setTimeout(function () {
                            moveMarker(marker, currentLat, currentLong);
                        }, 2000);
                    }
                    
                }
    }




 animation(marker1,boatSteps)

    </script>
   
</body>
</html>
